<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>Sistema de gestión de contenidos programáticos</title>
        <link rel="stylesheet" type="text/css" href="styles.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.0/jquery-ui.min.js"></script>
    </head>
    <body>
        <script type="text/javascript">
            var listaLineas = [];

            function cambiarPagina(number){
                sessionStorage.linea = listaLineas[number];
                window.location.href = "verLinea.html";
            }

            cargarLineas = function(){
                var promise = function(data){
                    console.log(data);
                    $("#lineas").children().remove();
                    for(i = 0; i < data.lines.length; i++){
                        listaLineas.push(data.lines[i].name);
                        $("#lineas").append("<li>\n<button type='button' onclick='cambiarPagina("+i+")'>\n"+data.lines[i].name+"\n</button>\n</li>");
                    }
                }
                $.get("/programs/"+sessionStorage.programa).then(promise);
            };

            function Line(name){
                this.name=name
            }

            registrarLinea = function(){
                var name = $("#nuevaLinea").val();
                var line = new Line(name);
                $.ajax({
                    type: "POST",
                    url: "/programs/"+sessionStorage.programa,
                    headers: {"X-HTTP-Method-Override": "POST", "Content-Type": "application/json"},
                    data: JSON.stringify(line)
                }).fail(function (response) {
                    console.log(response);
                    alert(response.responseText);
                }).then(cargarLineas());
            };

            $(document).ready(
                function(){
                    if(sessionStorage.programa == null){
                        window.location.href = "home.html";
                    }
                    cargarLineas();
                }
            );
        </script>
        <div id="banner">
            <img src="/banner.png" width="100%">
        </div>
        <div id="lines">
            Lineas del programa
            <ul id="lineas">

            </ul>
        </div>
        <p></p>
        <input type="text" id="nuevaLinea" value="Crear una linea"/>
        <button type="button" onclick="registrarLinea()">Registrar</button>
        <p></p>
        <div id="cenefa">
            Desarrollado por David Esteban Useche Pelaez - Laboratorio de informática. 2017
        </div>
    </body>
</html>